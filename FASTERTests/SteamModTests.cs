using System;
using NUnit.Framework;
using System.IO;
using System.Reflection;
// ReSharper disable CheckNamespace

namespace FASTER.Models.Tests
{
    [TestFixture()]
    public class SteamModTests
    {
        [Test()]
        public void SteamIdFromUrlTest()
        {
            Assert.That(SteamMod.SteamIdFromUrl("https://steamcommunity.com/workshop/filedetails/?id=463939057"), Is.EqualTo(463939057));
            Assert.That(SteamMod.SteamIdFromUrl("https://steamcommunity.com/workshop/filedetails/?id=463939057&l=french"), Is.EqualTo(463939057));
            Assert.That(SteamMod.SteamIdFromUrl("https://steamcommunity.com/sharedfiles/filedetails/?l=german&id=463939057"), Is.EqualTo(463939057));
            Assert.That(SteamMod.SteamIdFromUrl("https://steamcommunity.com/workshop/filedetails/?l=french&id=463939057"), Is.EqualTo(463939057));
            Assert.That(SteamMod.SteamIdFromUrl("https://steamcommunity.com/workshop/filedetails/?l=english&id=463939057&l=french"), Is.EqualTo(463939057));
        }


        [Test()]
        public void GetModInfoTest()
        {
            Tuple<string, string, int> expected = new Tuple<string, string, int>("ace", "acemod", 1577907553);
            Tuple<string, string, int> res = null;
            Assert.DoesNotThrow(() => { res = SteamMod.GetModInfo(463939057); });
            Assert.That(res.Item1, Is.EqualTo(expected.Item1), "The expected mod name was wrong");
            Assert.That(res.Item2, Is.EqualTo(expected.Item2), "The expected creator name was wrong");
            Assert.That(res.Item3, Is.GreaterThanOrEqualTo(expected.Item3), "The expected update time was wrong");
        }
    }

    [TestFixture()]
    public class ArmaProfileFileParsingTests
    {
        readonly string _armaProfileName = "FASTER_Testing.html";
        readonly string _armaProfileContent = "<?xml version=\"1.0\" encoding=\"utf-8\"?><html> <head> <meta name=\"arma:Type\" content=\"preset\"/> <meta name=\"arma:PresetName\" content=\"Arma 3 Vanilla plus CBA\"/> <meta name=\"generator\" content=\"Arma 3 Launcher - https://arma3.com\"/> <title>Arma 3</title> <link href=\"https://fonts.googleapis.com/css?family=Roboto\" rel=\"stylesheet\" type=\"text/css\"/> <style>body{margin: 0;padding: 0;color: #fff;background: #000;}body, th, td{font: 95%/1.3 Roboto, Segoe UI, Tahoma, Arial, Helvetica, sans-serif;}td{padding: 3px 30px 3px 0;}h1{padding: 20px 20px 0 20px; color: white; font-weight: 200; font-family: segoe ui; font-size: 3em; margin: 0;}em{font-variant: italic; color:silver;}.before-list{padding: 5px 20px 10px 20px;}.mod-list{background: #222222; padding: 20px;}.dlc-list{background: #222222; padding: 20px;}.footer{padding: 20px; color:gray;}.whups{color:gray;}a{color: #D18F21; text-decoration: underline;}a:hover{color:#F1AF41; text-decoration: none;}.from-steam{color: #449EBD;}.from-local{color: gray;}</style> </head> <body> <h1>Arma 3 - Preset <strong>Arma 3 Vanilla plus CBA</strong></h1> <p class=\"before-list\"> <em>Drag this file or link to it to Arma 3 Launcher or open it Mods / Preset / Import.</em> </p><div class=\"mod-list\"> <table> <tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">CBA_A3</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=450814997\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=450814997</a> </td></tr></table> </div><div class=\"dlc-list\"> <table> <tr data-type=\"DlcContainer\"> <td data-type=\"DisplayName\">Global Mobilization</td><td> <a href=\"https://store.steampowered.com/app/1042220\" data-type=\"Link\">https://store.steampowered.com/app/1042220</a> </td></tr><tr data-type=\"DlcContainer\"> <td data-type=\"DisplayName\">S.O.G. Prairie Fire</td><td> <a href=\"https://store.steampowered.com/app/1227700\" data-type=\"Link\">https://store.steampowered.com/app/1227700</a> </td></tr><tr data-type=\"DlcContainer\"> <td data-type=\"DisplayName\">CSLA Iron Curtain</td><td> <a href=\"https://store.steampowered.com/app/1294440\" data-type=\"Link\">https://store.steampowered.com/app/1294440</a> </td></tr><tr data-type=\"DlcContainer\"> <td data-type=\"DisplayName\">Western Sahara</td><td> <a href=\"https://store.steampowered.com/app/1681170\" data-type=\"Link\">https://store.steampowered.com/app/1681170</a> </td></tr></table> </div><div class=\"footer\"> <span>Created by Arma 3 Launcher by Bohemia Interactive.</span> </div></body></html>";

        readonly string _armaBugProfileContent = "<?xml version=\"1.0\" encoding=\"utf-8\"?><html> <head> <meta name=\"arma:Type\" content=\"preset\"/> <meta name=\"arma:PresetName\" content=\"Imported preset\"/> <meta name=\"generator\" content=\"Arma 3 Launcher - https://arma3.com\"/> <title>Arma 3</title> <link href=\"https://fonts.googleapis.com/css?family=Roboto\" rel=\"stylesheet\" type=\"text/css\"/> <style>body{margin: 0;padding: 0;color: #fff;background: #000;}body, th, td{font: 95%/1.3 Roboto, Segoe UI, Tahoma, Arial, Helvetica, sans-serif;}td{padding: 3px 30px 3px 0;}h1{padding: 20px 20px 0 20px; color: white; font-weight: 200; font-family: segoe ui; font-size: 3em; margin: 0;}em{font-variant: italic; color:silver;}.before-list{padding: 5px 20px 10px 20px;}.mod-list{background: #222222; padding: 20px;}.dlc-list{background: #222222; padding: 20px;}.footer{padding: 20px; color:gray;}.whups{color:gray;}a{color: #D18F21; text-decoration: underline;}a:hover{color:#F1AF41; text-decoration: none;}.from-steam{color: #449EBD;}.from-local{color: gray;}</style> </head> <body> <h1>Arma 3 - Preset <strong>Imported preset</strong></h1> <p class=\"before-list\"> <em>Drag this file or link to it to Arma 3 Launcher or open it Mods / Preset / Import.</em> </p><div class=\"mod-list\"> <table> <tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">@SID_CoolWalk</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=896073795\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=896073795</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">3CB BAF Vehicles</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=893349825\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=893349825</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">3CB Factions</td><td> <span class=\"from-local\">Local</span> </td><td> <span class=\"whups\" data-type=\"Link\" data-meta=\"local:3CB Factions|@3cb_factions|http://www.3commandobrigade.com\"> <a href=\"http://www.3commandobrigade.com\">http://www.3commandobrigade.com</a> </span> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">6 x 6 All Terrain Vehicle</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1190934425\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1190934425</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">A3 Thermal Improvement</td><td> <span class=\"from-local\">Local</span> </td><td> <span class=\"whups\" data-type=\"Link\" data-meta=\"local:A3 Thermal Improvement|@A3_Thermal_Improvement|\"/> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ace</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=463939057\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=463939057</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ACE Compat - RHS AFRF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=773131200\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=773131200</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ACE Compat - RHS USAF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=773125288\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=773125288</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ACE Compat - RHS: GREF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=884966711\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=884966711</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ACE Compat - RHS: SAF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2174495332\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2174495332</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ACE3 Arsenal Extended - Core</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2522638637\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2522638637</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ACE3 Arsenal Extended for USP AIO</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2522642015\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2522642015</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ACRE2</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=751965892\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=751965892</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">AH-64D Official Project</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1351428303\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1351428303</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ArmaForces - Friendly Tracker</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1952036908\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1952036908</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">BackpackOnChest</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=820924072\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=820924072</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Blastcore Murr Edition</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2257686620\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2257686620</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Breaching Charge</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1314910827\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1314910827</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Callsign Patch Pack 1</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=914911518\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=914911518</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">CBA_A3</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=450814997\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=450814997</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">CH View Distance</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=837729515\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=837729515</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">cTab NSWDG Edition</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2511318948\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2511318948</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">DET1 Ruck</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2781149877\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2781149877</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">dzn Extended Jamming</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1379304937\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1379304937</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Enhanced Movement</td><td> <span class=\"from-local\">Local</span> </td><td> <span class=\"whups\" data-type=\"Link\" data-meta=\"local:Enhanced Movement|@em|http://steamcommunity.com/sharedfiles/filedetails/?id=333310405\"> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=333310405\">http://steamcommunity.com/sharedfiles/filedetails/?id=333310405</a> </span> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Enhanced Soundscape</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=825179978\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=825179978</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">FA-18EF Super Hornet and USAF compat</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2419906119\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2419906119</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">FA-18-Super-Hornet-BETA</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1552807725\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1552807725</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Fawks\' Enhanced NVGs</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2513044572\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2513044572</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">FlankenLabs - United States SOCOM Gear (Retexture Project)</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1807386067\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1807386067</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">GOLD_Optics</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2196892007\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2196892007</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">GOLD_Weapons</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2195977056\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2195977056</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Goon\'s Toons</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1297175096\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1297175096</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Hatchet Framework - Development Version</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1745501106\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1745501106</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Hatchet H-60 pack - Development Version</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1745501605\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1745501605</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Hate\'s Digital Camera</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2577441180\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2577441180</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Hate\'s Electronic Warfare</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2557621743\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2557621743</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Immersive HALO Jump Mod [USAF+RHS]</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2171969018\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2171969018</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ITC Air Systems</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1321663083\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1321663083</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">KAT - Advanced Medical REWRITE</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2020940806\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2020940806</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">LAMBS_Danger.fsm (DEV)</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2434257231\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2434257231</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">NIArms All in One</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1208517358\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1208517358</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">NIArms Core</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=667454606\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=667454606</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">NIArms HK416 Rifles</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1519157834\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1519157834</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">No Weapon Sway</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=570118882\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=570118882</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Paddle Mod</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=887302721\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=887302721</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Reduced Haze Mod v3.1</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1397683809\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1397683809</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Remove stamina</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=632435682\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=632435682</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Remove stamina - ACE 3</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=782415569\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=782415569</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">RHSAFRF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=843425103\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=843425103</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">RHSGREF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=843593391\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=843593391</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">RHSSAF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=843632231\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=843632231</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">RHSUSAF</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=843577117\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=843577117</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">ROA L119A2</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2251849868\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2251849868</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Simplex Support Services</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1850026051\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1850026051</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Smart Aircraft Weapon Systems</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2322955920\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2322955920</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Swim With Any Uniform</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1598735666\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1598735666</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Tholozor\'s U.S. Special Operations Forces - Core (RHS Retexture)</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1292963000\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1292963000</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Tier One Weapons</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2268351256\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2268351256</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Turret Enhanced</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1623498241\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1623498241</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">USAF Mod - Fighters</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2397371875\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2397371875</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">USAF Mod - Main</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2397360831\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2397360831</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">USAF Mod - Utility</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2397376046\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2397376046</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">USAF_AC130_BETA</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2226368165\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2226368165</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">USP Gear &amp; Uniforms AIO</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1795825073\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1795825073</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Voldy\'s Improved Ammo</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1963617777\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1963617777</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Zeus Enhanced</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=1779063631\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=1779063631</a> </td></tr><tr data-type=\"ModContainer\"> <td data-type=\"DisplayName\">Zeus Enhanced - ACE3 Compatibility</td><td> <span class=\"from-steam\">Steam</span> </td><td> <a href=\"http://steamcommunity.com/sharedfiles/filedetails/?id=2018593688\" data-type=\"Link\">http://steamcommunity.com/sharedfiles/filedetails/?id=2018593688</a> </td></tr></table> </div><div class=\"dlc-list\"> <table/> </div><div class=\"footer\"> <span>Created by Arma 3 Launcher by Bohemia Interactive.</span> </div></body></html>";

        [Test()]
        public void ParseArmaProfileFile()
        {
            var fullPath = Path.Combine(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), _armaProfileName);
            if (!File.Exists(fullPath))
                File.WriteAllText(fullPath, _armaProfileContent);

            var modList = ModUtilities.ParseModsFromArmaProfileFile(fullPath);
            Assert.That(modList, Is.Not.Null);
            Assert.That(modList.Count, Is.EqualTo(1));
            Assert.That(modList[0].Name, Is.EqualTo("CBA_A3"));
            Assert.That(ModUtilities.GetCompareString(modList[0].Name), Is.EqualTo(ModUtilities.GetCompareString("@CBA_A3")));

            if (File.Exists(fullPath))
                File.Delete(fullPath);
        }

        [Test()]
        public void ParseBuggedArmaProfileFile()
        {
            var fullPath = Path.Combine(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), _armaProfileName);
            if (!File.Exists(fullPath))
                File.WriteAllText(fullPath, _armaBugProfileContent);

            var modList = ModUtilities.ParseModsFromArmaProfileFile(fullPath);
            Assert.That(modList, Is.Not.Null);
            Assert.That(modList.Count, Is.EqualTo(68));
            Assert.That(modList.FindAll(mod => !mod.IsLocal).Count, Is.EqualTo(65));
            Assert.That(modList.FindAll(mod => mod.IsLocal).Count, Is.EqualTo(3));

            var mod = modList.Find(m => m.Name == "A3 Thermal Improvement");
            Assert.That(mod, Is.Not.Null);
            Assert.That(mod.IsLocal);
            Assert.That(ModUtilities.GetCompareString(mod.Name), Is.EqualTo(ModUtilities.GetCompareString("@A3_Thermal_Improvement")));

            if (File.Exists(fullPath))
                File.Delete(fullPath);
        }
    }
}